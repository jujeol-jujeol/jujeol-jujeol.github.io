---
layout: post
title: '[FE] í™˜ê²½ë³€ìˆ˜ ì„¤ì •í•˜ê¸° - dotenv & snowpack'
description: >
  react í”„ë¡œì íŠ¸ì—ì„œ dotenvë¡œ í™˜ê²½ë³€ìˆ˜ ì„¤ì •í•˜ê¸°
tags: [jojal-jojal]
author: tyche
---

ìµœì¢…ì—…ë°ì´íŠ¸ : 2021.07.15

# í™˜ê²½ë³€ìˆ˜ ì„¤ì •í•˜ê¸°

## âœ”ï¸ í™˜ê²½ë³€ìˆ˜ë¥¼ ì„¤ì •í•œ ì´ìœ 
  - ê°œë°œì„ ì§„í–‰í•˜ë©´ì„œ localì—ì„œë§Œ ì§„í–‰í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼, ë°°í¬ëœ ì„œë²„ì—ë„ í•¨ê»˜ í…ŒìŠ¤íŠ¸í•´ì•¼í•  ë•Œê°€ ìˆë‹¤.
  - local í™˜ê²½ì—ì„œ í…ŒìŠ¤íŠ¸ í•  ë•Œì—ëŠ”, requestë¥¼ ë³´ë‚¼ ë•Œ BASE_URLì„ localhost:8080(ì„œë²„ ë¡œì»¬ ì£¼ì†Œ)ë¡œ ì§€ì •í•´ë‘ê³  ì„œë²„ ë¡œì»¬ì„ ì¼œì„œ ì§ì ‘ ìš”ì²­ê°’ì„ í™•ì¸í•˜ëŠ” ê³¼ì •ì´ ìˆì—ˆë‹¤.
  - í•˜ì§€ë§Œ, ê°œë°œ ì„œë²„ë¡œ í…ŒìŠ¤íŠ¸ í•˜ë ¤ë©´, í”„ë¡ íŠ¸ì—”ë“œì˜ ë°°í¬ ì„œë²„ì™€ ë°±ì—”ë“œì˜ ë°°í¬ ì„œë²„ë¡œ BASE_URLì„ ìˆ˜ì •í•´ì•¼í•˜ëŠ” ë²ˆê±°ë¡œì›€ì´ ìˆë‹¤.
  - ì´ëŸ¬í•œ ê³¼ì •ì„ ìë™í™”ë¥¼ í•´ì£¼ëŠ” ë°©ë²•ìœ¼ë¡œ ìš°ë¦¬ëŠ” dotenv ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ í†µí•œ í™˜ê²½ë³€ìˆ˜ ì„¤ì •í•˜ê¸°ë¡œ í–ˆë‹¤.

## âœ”ï¸ [dotenv](https://www.npmjs.com/package/dotenv) ë¼ì´ë¸ŒëŸ¬ë¦¬

### dotenvë€? 
  - **`dotenv`ëŠ” í™˜ê²½ë³€ìˆ˜ë¥¼Â `.env`íŒŒì¼ì— ì €ì¥í•˜ê³ Â `process.env`ë¡œ ë¡œë“œí•˜ëŠ” ì˜ì¡´ì„± ëª¨ë“ˆì´ë‹¤.** [ğŸ–‡ ì°¸ê³ ](https://velog.io/@reveloper-1311/DB-Node.js%EC%97%90%EC%84%9C-%ED%99%98%EA%B2%BD%EB%B3%80%EC%88%98-%EC%82%AC%EC%9A%A9%ED%95%98%EA%B8%B0dotenv)
  
- ë˜ë‹¤ë¥¸ í™˜ê²½ë³€ìˆ˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ëŠ” ë¬´ì—‡ì´ ìˆì„ê¹Œ?
  - cross-env
    - í”„ë¡œê·¸ë¨ì„ CLI í™˜ê²½ì—ì„œ ì‹¤í–‰ì‹œí‚¬ ë•Œì— í™˜ê²½ë³€ìˆ˜ë¥¼ ì„¤ì •í•˜ëŠ” ê¸°ëŠ¥ì„ ê°€ì§€ê³  ìˆë‹¤.
    - ì¦‰, dotenvëŠ” ë¯¸ë¦¬ ì‘ì„±í•œ íŒŒì¼ì„ í™˜ê²½ë³€ìˆ˜ë¡œ ì„¤ì •í•˜ê³ , [cross-env](https://www.npmjs.com/package/cross-env)ëŠ” ì½˜ì†”(CLI)ì— ì§ì ‘ ì…ë ¥í•˜ì—¬ í™˜ê²½ë³€ìˆ˜ë¥¼ ì„¤ì •í•œë‹¤.
    - ì—…ë°ì´íŠ¸ ì¤‘ì§€í•œë‹¤ëŠ” ì†Œì‹ì´..
    > ğŸš¨ NOTICE: cross-env still works well, but is in maintenance mode. No new features will be added, only serious and common-case bugs will be fixed, and it will only be kept up-to-date with Node.js over time.


## âœ”ï¸ ì„¤ì¹˜ ì‚½ì§ˆì˜ ì—¬ì •

### 1. dotenv ì„¤ì¹˜

    ```
    npm install dotenv
    ```

### 2. [@snowpack/plugin-dotenv](https://www.npmjs.com/package/@snowpack/plugin-dotenv) ì„¤ì¹˜

    ```
    npm install --save-dev @snowpack/plugin-dotenv
    ```
<br >

    ```
    // snowpack.config.json
    {
      "plugins": ["@snowpack/plugin-dotenv"]
    }
    ```

  - ì´ë¶€ë¶„ ì—„ì²­ í—¤ë§¸ë‹¤^^; ì²˜ìŒì—ëŠ” ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ìœ¼ë¡œ ìµœìƒë‹¨ì— .env íŒŒì¼ì´ ì‹œí–‰ë˜ê¸¸ë˜, `ì–´? ë˜ëŠ”ë°?` ì´ëŸ° ìƒê°ìœ¼ë¡œ í•˜ëŠ”ë° requestë¥¼ ì‚¬ìš©í•˜ëŠ” ìª½ì—ì„œ process.env.~ ë¡œ ì…ë ¥í•œ ë¶€ë¶„ì—ì„œ process.envì´ undefinedê°€ ë‚˜ì˜¤ëŠ” ê²ƒì´ ì•„ë‹Œê°€..^^
  - ê°€ì¥ ì¤‘ìš”í•œ ë¶€ë¶„ì€ ì•„ë˜ ì„¤ì •íŒŒì¼ì„ ë§Œë“¤ë•Œ ê¼­ `SNOWPACK_PUBLIC_ prefix`ë¥¼ ë¶™ì—¬ì•¼í•œë‹¤ëŠ” ê²ƒì´ë‹¤.
  - > âš ï¸Snowpack requires the SNOWPACK_PUBLIC_ prefix to recognize environment variables. This is to prevent accidental exposure of keys and secrets.
   ì´ë¶€ë¶„ ìš°ë¦¬ë§˜ëŒ€ë¡œ ê³ ì³¤ë‹¤ê°€ ê³„ì† ì•ˆë˜ëŠ”ê±° ëª°ëìë‚˜.. ğŸ‘€

### 3. ì„¤ì •íŒŒì¼ ë§Œë“¤ê¸° (frontend/env í´ë” ìƒì„±)

  ì•„ë§ˆ í•„ìš”ì— ì˜í•´ì„œ gitignoreë¥¼ í•´ì•¼í•  ìˆ˜ë„ ìˆì„ ê²ƒ ê°™ë‹¤.

  - localí™˜ê²½

        ```
        // .env.local

        SNOWPACK_PUBLIC_LOGIN_REDIRECT_URL=http://localhost:3000/ouath
        SNOWPACK_PUBLIC_API_URL=http://localhost:8080
        SNOWPACK_PUBLIC_KAKAO_CLIENT_ID=838bcd43c3b007b4ef38c3da555c4806
        ```

  - development í™˜ê²½

        ```
        // .env.development

        SNOWPACK_PUBLIC_LOGIN_REDIRECT_URL=https://dev-fe-jujeol-jujeol.netlify.app/ouath
        SNOWPACK_PUBLIC_API_URL=https://jujeol.kro.kr
        SNOWPACK_PUBLIC_KAKAO_CLIENT_ID=838bcd43c3b007b4ef38c3da555c4806
        ```

  - âš ï¸ SNOWPACK_PUBLICì€ snowpackì„ ì‚¬ìš©í•œë‹¤ë©´ í•„ìˆ˜ì´ë‹¤.

### 4. npm script ì‘ì„±

    ```
    //pacakge.json

    "scripts": {
        "start": "snowpack dev",
        "start:local": "cp ./env/.env.local ./.env && snowpack dev --polyfill-node", // ì¶”ê°€í•œ ë¶€ë¶„
        "start:dev": "cp ./env/.env.development ./.env && snowpack dev --polyfill-node", // ì¶”ê°€í•œ ë¶€ë¶„
        "build": "snowpack build",
        "build:local": "cp ./env/.env.local ./.env && snowpack build --polyfill-node", // ì¶”ê°€í•œ ë¶€ë¶„
        "build:dev": "cp ./env/.env.development ./.env && GENERATE_SOURCEMAP=false snowpack build --polyfill-node", // ì¶”ê°€í•œ ë¶€ë¶„
        "test": "jest src",
        "storybook": "start-storybook -p 6006",
        "storybook-build": "build-storybook",
        "type-check": "tsc"
      },
    ```

  - ëª…ë ¹ì–´ë¥¼ ì‹œí–‰í•  ë•ŒëŠ” npm run start:localê³¼ ê°™ì´ `npm run`ì„ í•´ì£¼ì–´ì•¼ í•œë‹¤. npm startëŠ” ë˜ëŠ”ë°? ì™œ runì„ ë¶™ì—¬ì•¼í•˜ì§€? ë¼ëŠ” ê³ ë¯¼ì„ ì ê¹ í–ˆëŠ”ë°, 
  
  > [npm-run-script | npm Docs](https://docs.npmjs.com/cli/v7/commands/npm-run-script) <br> run[-script] is used by the test, start, restart, and stop commands, but can be called directly, as well. When the scripts in the package are printed out, they're separated into lifecycle (test, start, restart) and directly-run scripts.
  ê¸°ì¡´ì˜ npm initì„ í•˜ë©´ `npm test, start, restart, and stopëŠ” ìƒëµì´ ê°€ëŠ¥í•œë°` ë‚˜ë¨¸ì§€ëŠ” runì„ ë¶™ì—¬ì£¼ì–´ì•¼ í•˜ëŠ” ê²ƒ ê°™ë‹¤.
  
  - `npm run, npm rum, npm urn`ë„ ë‹¤ ì§€ì›í•´ì¤€ë‹¤. ~~(ì„ë§ˆë‚˜ ì˜¤íƒ€ë¥¼ ë§ì´ ëƒˆìœ¼ë©´..)~~
  ì‹¬ì§€ì–´ `npm run-script`ê°€ ì›ë˜ full syntaxì´ë‹¤.

  - âš ï¸ npm scriptì—ì„œ `--polyfill-node`ë¥¼ ë¶™ì—¬ì¤€ ì´ìœ 
    ë‹¤ìŒê³¼ ê°™ì€ ì—ëŸ¬ê°€ ë– ì„œ, snowpackì´ ì‹œí‚¤ëŠ”ëŒ€ë¡œ ë§¨ ë’¤ì— ë¶™ì—¬ì£¼ì—ˆë‹¤. ê¶ê¸ˆí•œ ì ì€ í•œë²ˆ ì˜¤ë¥˜ê°€ ë– ì„œ `--polyfill-node`ë¥¼ ë¶™ì—¬ì¤˜ì„œ í•´ê²°í•˜ê³ , ë‹¤ì‹œ ì‚­ì œë¥¼ í–ˆëŠ”ë° snowpackì—ì„œ ìºì‹±ì„ í•˜ëŠ” ê±´ì§€ ì˜¤ë¥˜ê°€ ì•ˆë‚˜ë”ë¼.. ğŸ˜¢
  <img width="885" alt="polyfillnode ê´€ë ¨ ì—ëŸ¬ì´ë¯¸ì§€" src="/assets/img/20210715/polyfillerror.png">

  - [ğŸ– ê°€ëŠ¥í•©ë‹ˆë‹¤. í™•ì¸ì™„ë£Œ] ê°œì¸ì ì¸ ìƒê°ìœ¼ë¡œëŠ” ì„¤ì •íŒŒì¼ì— ë‹¤ìŒê³¼ ê°™ì´ ì“°ë©´ ì € ë¬¸êµ¬ë¥¼ scriptì—ì„œ ëª¨ë‘ ìƒëµí•  ìˆ˜ ìˆì„ ê²ƒ ê°™ë‹¤ëŠ” ëŠë‚Œì´..? [ğŸ–‡ ê³µì‹ë¬¸ì„œ](https://snowpack-git-config-api-finalize.pikapkg.vercel.app/reference/configuration#installoptions.polyfillnode-%7C-boolean)


        ```
        //snowpack.config.json

        module.exports = {
          installOptions: {
            polyfillNode: true
          },
        };
        ```<img width="689" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2021-07-16 á„‹á…©á„Œá…¥á†« 12 47 02" src="https://user-images.githubusercontent.com/59258239/125817524-949380aa-c73f-4204-9a2c-a5253f38e7cb.png">

        
   ğŸ–‡ [Polyfill - ìš©ì–´ ì‚¬ì „ | MDN](https://developer.mozilla.org/ko/docs/Glossary/Polyfill)ì´ë€?

### 5. í™˜ê²½ë³€ìˆ˜ë¥¼ ì‚¬ìš©í•˜ëŠ” ê³³ì—ì„œ ì½”ë“œ ìˆ˜ì •í•˜ê¸°

    ```
    const BASE_URL = process.env.SNOWPACK_PUBLIC_API_URL;
    ```

### 6 ìµœìƒë‹¨ íŒŒì¼ì—ì„œ(ë˜ëŠ” ì‚¬ìš©í•˜ëŠ” íŒŒì¼ì—ì„œ) dotenv import í•˜ê¸°

    ```
    import dotenv from 'dotenv';

    dotenv.config();
    ```


  <img width="689" alt="dotenvì˜ import í•˜ëŠ” ë°©ë²•ì— ëŒ€í•œ npm dotenv ì„¤ëª…" src="/assets/img/20210715/dotenv.png">


## âœ”ï¸ ì´ì–´ì§€ëŠ” ê¸€ì—ëŠ”..

í˜„ì¬ ë°°í¬ë¥¼ netlifyë¥¼ í†µí•´ì„œ í•˜ê³  ìˆëŠ”ë°, ì´ ì•ˆì—ì„œ build commandë¥¼ í†µí•´ì„œ .env íŒŒì¼ì— ìˆëŠ” ë‚´ìš©ì„ ì‘ì„±í•  ìˆ˜ ìˆë‹¤ê³  í•œë‹¤. ë‹¤ìŒì— ë°ëª¨ë°ì´ë•Œ ë°°í¬í•  ë•Œ ì¶”ê°€ë¡œ ì‘ì„±í•´ë³´ê² ë‹¤.

### âœ”ï¸ ê¸°íƒ€

í™˜ê²½ë³€ìˆ˜ë€?

- í™˜ê²½ë³€ìˆ˜ëŠ” OSì…ì¥ì—ì„œ í•´ë‹¹ í”„ë¡œì„¸ìŠ¤ë¥¼ ì‹¤í–‰ì‹œí‚¤ê¸° ìœ„í•˜ì—¬ ì°¸ì¡°í•˜ëŠ” ë³€ìˆ˜


### ğŸ–‡ ì°¸ê³ ë¬¸ì„œ
- [dotenv](https://www.npmjs.com/package/dotenv) ë¼ì´ë¸ŒëŸ¬ë¦¬
- [dotenv ë° í™˜ê²½ë³€ìˆ˜ ì •ë¦¬ ë¸”ë¡œê·¸ ê¸€](https://velog.io/@reveloper-1311/DB-Node.js%EC%97%90%EC%84%9C-%ED%99%98%EA%B2%BD%EB%B3%80%EC%88%98-%EC%82%AC%EC%9A%A9%ED%95%98%EA%B8%B0dotenv)
- [cross-env](https://www.npmjs.com/package/cross-env)
- [@snowpack/plugin-dotenv](https://www.npmjs.com/package/@snowpack/plugin-dotenv)
- [snowpack/polyfillnode](https://snowpack-git-config-api-finalize.pikapkg.vercel.app/reference/configuration#installoptions.polyfillnode-%7C-boolean)
- [npm-run-script | npm Docs](https://docs.npmjs.com/cli/v7/commands/npm-run-script)
- [Polyfill - ìš©ì–´ ì‚¬ì „ | MDN](https://developer.mozilla.org/ko/docs/Glossary/Polyfill)
